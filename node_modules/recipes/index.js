var pg = require('pg');
pg.defaults.ssl = true;
var uripg ="postgres://qpctvfkpaktrbh:850e3c5962c7eb37c0e7b5b5383a38a0d6c537854dbba0d80052f3ff5b14707a@ec2-54-83-26-65.compute-1.amazonaws.com:5432/dav91uknip05h0";

var getAll = function(req, res){
  pg.connect(uripg  ,function(err, client, done) {
    if (err) throw err;
    client
      .query("Select r.id_recipe, r.title_recipe, d.title_difficulty, t.title_type, r.time_recipe, r.popularity, r.peopleamount, o.title_origin, r.description, r.imgurl FROM public.recipe r, public.difficulty d, public.origin o, public.type t WHERE r.id_difficulty = d.id_difficulty AND r.id_origin = o.id_origin AND r.id_type = t.id_type;")
      .on("end", function(result) { done();
        res.send(result.rows);

      });
  });
}

var getTypes = function(req, res){
  pg.connect(uripg  ,function(err, client, done) {
    if (err) throw err;
    client
      .query("SELECT * FROM public.type;")
      .on('end', function(result) { done();
        res.send(result.rows);

      });
  });
}

var getDifficulties = function(req,res){
  pg.connect(uripg  ,function(err, client, done) {
    if (err) throw err;
    client
      .query("SELECT * FROM public.difficulty;")
      .on('end', function(result) { done();
        res.send(result.rows);

      });
  });
}

var getOrigins = function(req, res){
  pg.connect(uripg  ,function(err, client, done) {
    if (err) throw err;
    client
      .query("SELECT * FROM public.origin;")
      .on('end', function(result) { done();
        res.send(result.rows);

      });
  });
}

exports.getOrigins = getOrigins;
exports.getDifficulties = getDifficulties;
exports.getTypes = getTypes;
exports.getAll = getAll;
